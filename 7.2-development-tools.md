# Development Tools

> **Relevant source files**
> * [classes/apps/linux-devtunnel](https://github.com/ComitFS/cas-service/blob/b7087e8d/classes/apps/linux-devtunnel)
> * [classes/apps/macos-devtunnel](https://github.com/ComitFS/cas-service/blob/b7087e8d/classes/apps/macos-devtunnel)
> * [classes/apps/win-devtunnel.exe](https://github.com/ComitFS/cas-service/blob/b7087e8d/classes/apps/win-devtunnel.exe)

This document covers the development tools and utilities provided for local testing and debugging of the CAS Service Plugin. These tools facilitate development workflow by enabling secure tunneling, local testing environments, and debugging capabilities for the Openfire plugin and its integrations with Microsoft services.

For information about the build system and CI/CD processes, see [Build System & CI/CD](./7.1-build-system-and-cicd.md). For deployment procedures and system requirements, see [Requirements & Documentation](./7.3-requirements-and-documentation.md).

## DevTunnel Applications

The CAS service includes platform-specific development tunnel applications that enable secure local development and testing of the Openfire plugin without requiring full cloud deployment.

### macOS DevTunnel

The primary development tool is the macOS DevTunnel application, which provides secure tunneling capabilities for local development environments.

```mermaid
flowchart TD

DevTunnel["macos-devtunnel"]
LocalOpenfire["Local Openfire Server"]
CASPlugin["CAS Service Plugin"]
LocalBrowser["Local Browser"]
MSTeams["Microsoft Teams"]
AzureACS["Azure Communication Services"]
MSGraph["Microsoft Graph API"]
SecureTunnel["HTTPS Tunnel"]
PublicEndpoint["Public HTTPS Endpoint"]

DevTunnel --> SecureTunnel
PublicEndpoint --> MSTeams
PublicEndpoint --> AzureACS
PublicEndpoint --> MSGraph
MSTeams --> PublicEndpoint
AzureACS --> PublicEndpoint
MSGraph --> PublicEndpoint

subgraph subGraph2 ["Tunnel Infrastructure"]
    SecureTunnel
    PublicEndpoint
    SecureTunnel --> PublicEndpoint
end

subgraph subGraph1 ["External Services"]
    MSTeams
    AzureACS
    MSGraph
end

subgraph subGraph0 ["Local Development Environment"]
    DevTunnel
    LocalOpenfire
    CASPlugin
    LocalBrowser
    LocalOpenfire --> CASPlugin
    CASPlugin --> DevTunnel
    LocalBrowser --> LocalOpenfire
end
```

**DevTunnel Application Architecture**

The DevTunnel creates a secure HTTPS tunnel that exposes local development instances to external Microsoft services, enabling webhook callbacks and OAuth flows to function properly during development.

Sources: [classes/apps/macos-devtunnel](https://github.com/ComitFS/cas-service/blob/b7087e8d/classes/apps/macos-devtunnel)

### Key Capabilities

| Feature | Description | Use Case |
| --- | --- | --- |
| **HTTPS Tunneling** | Creates secure tunnel from local development to public endpoint | Testing webhook callbacks from Microsoft services |
| **OAuth Integration** | Enables proper OAuth redirect flows during development | Testing Microsoft Teams app authentication |
| **Webhook Support** | Allows external services to send webhooks to local development | Testing Azure Communication Services event callbacks |
| **SSL Termination** | Handles SSL/TLS termination for local HTTPS requirements | Meeting Microsoft API security requirements |

## Local Testing Infrastructure

The development tools support comprehensive local testing of the CAS service components and their integrations.

```mermaid
flowchart TD

DevStart["Start Local Development"]
LaunchTunnel["Launch DevTunnel"]
ConfigOpenfire["Configure Openfire"]
DeployPlugin["Deploy CAS Plugin"]
TestIntegrations["Test Integrations"]
TeamsApp["Teams App Testing"]
ACSCalls["ACS Call Testing"]
WebHooks["Webhook Testing"]
RealTimeComms["Real-time Communication Testing"]
MockTeams["Mock Teams Responses"]
MockACS["Mock ACS Events"]
MockGraph["Mock Graph API"]

TestIntegrations --> TeamsApp
TestIntegrations --> ACSCalls
TestIntegrations --> WebHooks
TestIntegrations --> RealTimeComms
TeamsApp --> MockTeams
ACSCalls --> MockACS
WebHooks --> MockGraph

subgraph subGraph2 ["External Service Mocking"]
    MockTeams
    MockACS
    MockGraph
end

subgraph subGraph1 ["Testing Components"]
    TeamsApp
    ACSCalls
    WebHooks
    RealTimeComms
end

subgraph subGraph0 ["Development Workflow"]
    DevStart
    LaunchTunnel
    ConfigOpenfire
    DeployPlugin
    TestIntegrations
    DevStart --> LaunchTunnel
    LaunchTunnel --> ConfigOpenfire
    ConfigOpenfire --> DeployPlugin
    DeployPlugin --> TestIntegrations
end
```

**Local Development Testing Flow**

This diagram shows how the DevTunnel integrates into the local development workflow, enabling comprehensive testing of Microsoft service integrations.

### Testing Scenarios

The development tools support testing of key CAS service scenarios:

* **Microsoft Teams App Integration**: Testing tab functionality, bot responses, and authentication flows
* **Azure Communication Services**: Testing call automation, DTMF handling, and voice interactions
* **Real-time Communication**: Testing WebSocket connections, audio streaming, and live transcription
* **Webhook Processing**: Testing incoming webhooks from Microsoft services and third-party integrations

Sources: [classes/apps/macos-devtunnel](https://github.com/ComitFS/cas-service/blob/b7087e8d/classes/apps/macos-devtunnel)

## Development Workflow Integration

The DevTunnel application integrates with the broader development ecosystem to provide seamless local development experience.

```mermaid
flowchart TD

VSCode["VS Code"]
IntelliJ["IntelliJ IDEA"]
DebugConfig["Debug Configuration"]
OpenfireLocal["Openfire Server<br>localhost:9090"]
CASLocalAPI["CAS REST API<br>localhost:9090/casapi"]
WebSockets["WebSocket Endpoints<br>localhost:9090/ws"]
TunnelApp["macos-devtunnel"]
TunnelEndpoint["Unsupported markdown: link"]
ProxyRules["Proxy Configuration"]
TeamsApps["Teams App Manifest"]
ACSConfig["ACS Configuration"]
GraphAPI["Graph API Callbacks"]

DebugConfig --> OpenfireLocal
CASLocalAPI --> TunnelApp
WebSockets --> TunnelApp
TunnelEndpoint --> TeamsApps
TunnelEndpoint --> ACSConfig
TunnelEndpoint --> GraphAPI

subgraph subGraph3 ["Microsoft Services"]
    TeamsApps
    ACSConfig
    GraphAPI
end

subgraph DevTunnel ["DevTunnel"]
    TunnelApp
    TunnelEndpoint
    ProxyRules
    TunnelApp --> TunnelEndpoint
    TunnelApp --> ProxyRules
end

subgraph subGraph1 ["Local Services"]
    OpenfireLocal
    CASLocalAPI
    WebSockets
    OpenfireLocal --> CASLocalAPI
    OpenfireLocal --> WebSockets
end

subgraph IDE/Editor ["IDE/Editor"]
    VSCode
    IntelliJ
    DebugConfig
    VSCode --> DebugConfig
    IntelliJ --> DebugConfig
end
```

**Development Environment Integration**

This diagram illustrates how the DevTunnel bridges local development services with external Microsoft service requirements.

### Configuration Management

The DevTunnel supports flexible configuration for different development scenarios:

* **Environment-specific endpoints**: Different tunnel URLs for development, staging, and testing
* **Service-specific routing**: Routing different API paths to appropriate local services
* **Security configurations**: SSL certificate management and authentication handling
* **Logging and monitoring**: Request/response logging for debugging integration issues

## Debugging Utilities

The development tools provide comprehensive debugging capabilities for troubleshooting CAS service integrations and functionality.

### Debug Features

| Utility | Purpose | Technical Details |
| --- | --- | --- |
| **Request Logging** | Log all HTTP requests/responses through tunnel | Captures Microsoft service webhook payloads and API responses |
| **WebSocket Monitoring** | Monitor real-time communication streams | Debug audio streaming and live transcription issues |
| **Authentication Debugging** | Trace OAuth and authentication flows | Verify Microsoft Graph and Teams authentication |
| **Event Tracing** | Track Azure Communication Services events | Monitor call automation and DTMF event processing |

### Local Development Configuration

```mermaid
sequenceDiagram
  participant Developer
  participant macos-devtunnel
  participant Local Openfire
  participant Microsoft Services

  Developer->>macos-devtunnel: Start tunnel with config
  macos-devtunnel->>macos-devtunnel: Generate public HTTPS endpoint
  macos-devtunnel->>Local Openfire: Configure proxy rules
  Developer->>Local Openfire: Deploy CAS plugin
  Local Openfire->>macos-devtunnel: Register webhook endpoints
  Microsoft Services->>macos-devtunnel: Send webhook/callback
  macos-devtunnel->>Local Openfire: Forward to local service
  Local Openfire->>macos-devtunnel: Process and respond
  macos-devtunnel->>Microsoft Services: Return response
  note over Developer,Microsoft Services: All traffic logged for debugging
```

**Development Tunnel Communication Flow**

This sequence diagram shows how the DevTunnel facilitates bidirectional communication between local development and Microsoft services.

The development tools ensure that local testing closely mirrors production behavior while providing the debugging visibility needed for efficient development and troubleshooting.

Sources: [classes/apps/macos-devtunnel](https://github.com/ComitFS/cas-service/blob/b7087e8d/classes/apps/macos-devtunnel)